<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</title>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap");

    body {
      background-color: #0a1a64;
      margin: 0;
      font-family: "Prompt", sans-serif;
    }

    .header {
      padding: 15px;
      color: #ffffff;
    }

    .header .text {
      font-weight: bold;
      font-size: 20px;
    }

    .container {
      display: grid;
      padding: 10px;
      background-color: aliceblue;
      border-radius: 25px 25px 0 0;
      font-weight: normal;
    }

    .environment {
      display: grid;
    }

    .text-Title {
      font-size: 16px;
      color: #454545;
      padding-left: 10px;
    }

    .text-Time {
      font-size: 10px;
      font-weight: normal;
      color: #6d6d6d;
    }

    .text-label {
      color: #dedede;
      font-size: 10px;
    }

    .text-value {
      font-size: 14px;
    }

    .card-mainEnvi {
      display: flex;
      background-image: url("Background.png");
      background-color: #ffffff;
      border-radius: 15px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
      padding: 20px;
      margin-bottom: 10px;
      /* text-align: center; */
    }

    .card-mainEnvi .column {
      flex: 1;
      padding: 0 10px;
    }

    .card-control {
      display: flex;
      background: #0a1a64;
      border-radius: 15px;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 10px;
    }

    .card-detail {
      display: flex;
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 10px;
    }

    /* Toggle switch style */
    .pump-group {
      display: flex;
      gap: 15px;
      justify-content: space-between;
      /* ‡∏´‡∏£‡∏∑‡∏≠ center */
      flex-wrap: nowrap;
    }

    .pump-card {
      width: 30%;
      /* ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏ô 250px */
      background: white;
      padding: 10px;
      border-radius: 15px;
      font-family: "Prompt", sans-serif;
      color: #2e2e2e;
      box-shadow: 0 2px 6px rgba(255, 255, 255, 0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pump-label {
      font-size: 12px;
      font-weight: bold;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 22px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #888;
      border-radius: 28px;
      transition: 0.4s;
    }

    .slider::before {
      position: absolute;
      content: "";
      height: 15px;
      width: 15px;
      left: 2px;
      bottom: 3.5px;
      background-color: white;
      border-radius: 50%;
      transition: 0.4s;
    }

    input:checked+.slider {
      background-color: #3b0ea3;
    }

    input:checked+.slider::before {
      transform: translateX(21px);
    }

    .card-info {
      margin-top: 8px;
      font-size: 10px;
      color: #333;
    }
  </style>
</head>

<body>
  <div class="header">
    <div class="text">Tuawor Smart Farm</div>
    <div class="text-Time" id="lastUpdate"></div>
  </div>
  <div class="container">
    <div class="environment">
      <div class="text-Title">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</div>
      <div class="card-mainEnvi">
        <div class="column">
          <div class="column">
            <div>
              <div class="text-label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
              <div class="text-value" id="temp">--</div>
            </div>
            <div>
              <div class="text-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</div>
              <div class="text-value" id="humidity">--</div>
            </div>
            <div>
              <div class="text-label">‡πÅ‡∏™‡∏á‡πÅ‡∏î‡∏î</div>
              <div class="text-value" id="light">--</div>
            </div>
          </div>
        </div>
        <div class="column">
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 01</div>
            <div class="text-value" id="pump1">--</div>
          </div>
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 02</div>
            <div class="text-value" id="pump2">--</div>
          </div>
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 03</div>
            <div class="text-value" id="pump3">--</div>
          </div>
        </div>
      </div>

      <div class="text-Title">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</div>
      <div class="card-control">
        <div class="pump-group">

          <!-- ‡∏õ‡∏±‡πä‡∏° 01 -->
          <div class="pump-card">
            <div class="card-header">
              <span class="pump-label">‡∏õ‡∏±‡πâ‡∏° <strong>01</strong></span>
              <label class="switch">
                <input type="checkbox" id="pump01Switch" onchange="togglePump(1)" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="card-info">
              <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : <span id="pump01Status">--</span></div>
              <div>
                ‡πÄ‡∏£‡∏¥‡πà‡∏° : <span id="pump01Start">--:--</span> ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô :
                <span id="pump01Humidity">--¬∞C</span>
              </div>
            </div>
          </div>

          <!-- ‡∏õ‡∏±‡πä‡∏° 02 -->
          <div class="pump-card">
            <div class="card-header">
              <span class="pump-label">‡∏õ‡∏±‡πâ‡∏° <strong>02</strong></span>
              <label class="switch">
                <input type="checkbox" id="pump02Switch" onchange="togglePump(2)" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="card-info">
              <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : <span id="pump02Status">--</span></div>
              <div>
                ‡πÄ‡∏£‡∏¥‡πà‡∏° : <span id="pump02Start">--:--</span> ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô :
                <span id="pump02Humidity">--¬∞C</span>
              </div>
            </div>
          </div>

          <!-- ‡∏õ‡∏±‡πä‡∏° 03 -->
          <div class="pump-card">
            <div class="card-header">
              <span class="pump-label">‡∏õ‡∏±‡πâ‡∏° <strong>03</strong></span>
              <label class="switch">
                <input type="checkbox" id="pump03Switch" onchange="togglePump(3)" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="card-info">
              <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : <span id="pump03Status">--</span></div>
              <div>
                ‡πÄ‡∏£‡∏¥‡πà‡∏° : <span id="pump03Start">--:--</span> ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô :
                <span id="pump03Humidity">--¬∞C</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="text-Title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
      <div class="card-detail">
        <p></p>
      </div>
    </div>
  </div>
</body>

<script>
  const sheetURL = "https://script.google.com/macros/s/AKfycbxCZtqh7Q9mc7c8fWYn7RmCa-ytqu75DF9aTrdyRK6zvrDXr0AEKX6M17_z-NiRlEmkjQ/exec";
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô-‡∏õ‡∏µ-‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢
  function getThaiDateTime(date) {
    const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå",];
    const months = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°",];

    const day = days[date.getDay()];
    const d = date.getDate();
    const m = months[date.getMonth()];
    const y = date.getFullYear() + 543;
    const h = date.getHours().toString().padStart(2, "0");
    const min = date.getMinutes().toString().padStart(2, "0");
    const sec = date.getSeconds().toString().padStart(2, "0");
    const fullText = `‡∏ß‡∏±‡∏ô${day} ‡∏ó‡∏µ‡πà ${d} ${m} ‡∏û.‡∏®. ${y} ‡πÄ‡∏ß‡∏•‡∏≤ ${h}:${min} ‡∏ô.`;
    return [day, fullText, d, m, y, h, min, sec];
  }

  let firstLoad = true;
  async function loadData() {
    try {
      const res = await fetch(sheetURL);
      const data = await res.json();

      for (const key in data) {
        if (data[key] === "" || data[key] === 0 || data[key] === null || data[key] === undefined) {
          data[key] = "--";
        }
      }

      document.getElementById("temp").textContent = data.temperature === "--" ? "--" : "üå°Ô∏è" + data.temperature + "¬∞C";
      document.getElementById("humidity").textContent = data.humidity === "--" ? "--" : "üíß" + data.humidity + "%";
      document.getElementById("light").textContent = data.light === "--" ? "--" : "üå§Ô∏è" + data.light + " Lux";

      document.getElementById("pump1").textContent = data.pump1 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : data.pump1 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--";
      document.getElementById("pump2").textContent = data.pump2 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : data.pump2 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--";
      document.getElementById("pump3").textContent = data.pump3 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : data.pump3 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--";

      // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ checkbox switch ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á
      if (firstLoad) {
        document.getElementById("pump01Switch").checked = data.pump1 === "ON";
        document.getElementById("pump02Switch").checked = data.pump2 === "ON";
        document.getElementById("pump03Switch").checked = data.pump3 === "ON";
        firstLoad = false;
      }
      /*
      // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á
      document.getElementById("pump01Status").textContent = data.pump1 === "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î" : "‡∏õ‡∏¥‡∏î";
      document.getElementById("pump02Status").textContent = data.pump2 === "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î" : "‡∏õ‡∏¥‡∏î";
      document.getElementById("pump03Status").textContent = data.pump3 === "ON" ? "‡πÄ‡∏õ‡∏¥‡∏î" : "‡∏õ‡∏¥‡∏î";

      // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏" ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î
      document.getElementById("pump01Start").textContent = data.pump1 === "ON" ? "--:--" : "--:--";
      document.getElementById("pump02Start").textContent = data.pump2 === "ON" ? "--:--" : "--:--";
      document.getElementById("pump03Start").textContent = data.pump3 === "ON" ? "--:--" : "--:--";

      // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô "--¬∞C" ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
      document.getElementById("pump01Humidity").textContent = "--¬∞C";
      document.getElementById("pump02Humidity").textContent = "--¬∞C";
      document.getElementById("pump03Humidity").textContent = "--¬∞C";
      */

      const now = new Date();
      const dataTime = getThaiDateTime(now);
      const thaiDateTime = dataTime[1];

      document.getElementById("lastUpdate").textContent = thaiDateTime;
    } catch (error) {
      console.error("‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", error);
    }
  }

  function updatePumpStatus(pumpNumber, status) {
    const url = `${sheetURL}?action=updatePump${pumpNumber}&status=${status}`;
    fetch(url)
      .then((res) => res.json())
      .then((data) => {
        console.log(data.message);

        // ‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡πä‡∏°
        loadData();
      })
      .catch((err) => {
        console.error("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏±‡πä‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      });
  }



  function togglePump(pumpNumber) {
    const isChecked = document.getElementById(`pump0${pumpNumber}Switch`).checked;
    const status = isChecked ? "ON" : "OFF";

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    document.getElementById(`pump0${pumpNumber}Status`).textContent = isChecked ? "‡πÄ‡∏õ‡∏¥‡∏î" : "‡∏õ‡∏¥‡∏î";

    if (isChecked) {
      const now = new Date();
      const time = now.getHours().toString().padStart(2, "0") + ":" + now.getMinutes().toString().padStart(2, "0");
      document.getElementById(`pump0${pumpNumber}Start`).textContent = time;
      document.getElementById(`pump0${pumpNumber}Humidity`).textContent = Math.floor(Math.random() * 50 + 30) + "¬∞C";
    } else {
      document.getElementById(`pump0${pumpNumber}Start`).textContent = "--:--";
      document.getElementById(`pump0${pumpNumber}Humidity`).textContent = "--¬∞C";
    }

    // üîÅ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet
    updatePumpStatus(pumpNumber, status);
  }



  window.onload = () => {
    loadData();
    setInterval(loadData, 200); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  };
</script>

</html>

<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap');

    body {
      background-color: #0a1a64;
      margin: 0;
      font-family: 'Prompt', sans-serif;
    }

    .header {
      padding: 15px;
      color: #ffffff;
    }

    .header .text {
      font-weight: bold;
      font-size: 20px;
    }

    .container {
      display: grid;
      padding: 10px;
      background-color: aliceblue;
      border-radius: 25px 25px 0 0;
      font-weight: normal;
    }

    .environment {
      display: grid;
    }

    .text-Title {
      font-size: 16px;
      color: #454545;
      padding-left: 10PX;
    }

    .text-Time {
      font-size: 10px;
      font-weight: normal;
      color: #6d6d6d;
    }

    .text-label {
      color: #dedede;
      font-size: 10px;
    }

    .text-value {
      font-size: 14px;
    }

    .card-mainEnvi {
      display: flex;
      background-image: url('Background.png');
      background-color: #ffffff;
      border-radius: 15PX;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
      padding: 20px;
      margin-bottom: 10px;
      /* text-align: center; */
    }

    .card-mainEnvi .column {
      flex: 1;
      padding: 0 10px;
    }

    .card-control {
      display: flex;
      background: #0a1a64;
      border-radius: 15PX;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 10px;
    }

    .card-detail {
      display: flex;
      background: #ffffff;
      border-radius: 15PX;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 10px;
    }


    /* ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏ô‡πâ‡∏≥*/
    .pump-group {
      display: flex;
      gap: 15px;
      justify-content: space-between;
      /* ‡∏´‡∏£‡∏∑‡∏≠ center */
      flex-wrap: nowrap;
    }

    .pump-card {
      width: 30%;
      /* ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏ô 250px */
      background: white;
      padding: 10px;
      border-radius: 15px;
      font-family: 'Prompt', sans-serif;
      color: #939393;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pump-label {
      font-size: 12px;
      font-weight: bold;
    }

    /* Toggle switch style */
    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 22px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #888;
      border-radius: 28px;
      transition: 0.4s;
    }

    .slider::before {
      position: absolute;
      content: "";
      height: 15px;
      width: 15px;
      left: 2px;
      bottom: 3.5px;
      background-color: white;
      border-radius: 50%;
      transition: 0.4s;
    }

    input:checked+.slider {
      background-color: #3b0ea3;
    }

    input:checked+.slider::before {
      transform: translateX(21px);
    }

    .card-info {
      margin-top: 8px;
      font-size: 10px;
      color: #333;
    }

  </style>
</head>

<body>

  <div class="header">
    <div class="text">Tuawor Smart Farm</div>
    <div class="text-Time" id="lastUpdate"></div>
  </div>
  <div class="container">
    <div class="environment">
      <div class="text-Title">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</div>
      <div class="card-mainEnvi">
        <div class="column">
          <div class="column">
            <div>
              <div class="text-label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
              <div class="text-value" id="temp">--</div>
            </div>
            <div>
              <div class="text-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</div>
              <div class="text-value" id="humidity">--</div>
            </div>
            <div>
              <div class="text-label">‡πÅ‡∏™‡∏á‡πÅ‡∏î‡∏î</div>
              <div class="text-value" id="light">--</div>
            </div>
          </div>
        </div>
        <div class="column">
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 01</div>
            <div class="text-value" id="pump1">--</div>
          </div>
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 02</div>
            <div class="text-value" id="pump2">--</div>
          </div>
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 03</div>
            <div class="text-value" id="pump3">--</div>
          </div>
        </div>
      </div>

      <div class="text-Title">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</div>
      <div class="card-control">

        <div class="pump-group">
          <!-- ‡∏õ‡∏±‡πä‡∏° 01 -->
          <div class="pump-card">
            <div class="card-header">
              <span class="pump-label">‡∏õ‡∏±‡πâ‡∏° <strong>01</strong></span>
              <label class="switch">
                <input type="checkbox" id="pump01Switch" onchange="togglePump(1)">
                <span class="slider"></span>
              </label>
            </div>
            <div class="card-info">
              <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : <span id="pump01Status">--</span></div>
              <div>‡πÄ‡∏£‡∏¥‡πà‡∏° : <span id="pump01Start">--:--</span> ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô : <span id="pump01Humidity">--¬∞C</span></div>
            </div>
          </div>

          <!-- ‡∏õ‡∏±‡πä‡∏° 02 -->
          <div class="pump-card">
            <div class="card-header">
              <span class="pump-label">‡∏õ‡∏±‡πâ‡∏° <strong>02</strong></span>
              <label class="switch">
                <input type="checkbox" id="pump02Switch" onchange="togglePump(2)">
                <span class="slider"></span>
              </label>
            </div>
            <div class="card-info">
              <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : <span id="pump02Status">--</span></div>
              <div>‡πÄ‡∏£‡∏¥‡πà‡∏° : <span id="pump02Start">--:--</span> ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô : <span id="pump02Humidity">--¬∞C</span></div>
            </div>
          </div>

          <!-- ‡∏õ‡∏±‡πä‡∏° 03 -->
          <div class="pump-card">
            <div class="card-header">
              <span class="pump-label">‡∏õ‡∏±‡πâ‡∏° <strong>03</strong></span>
              <label class="switch">
                <input type="checkbox" id="pump03Switch" onchange="togglePump(3)">
                <span class="slider"></span>
              </label>
            </div>
            <div class="card-info">
              <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : <span id="pump03Status">--</span></div>
              <div>‡πÄ‡∏£‡∏¥‡πà‡∏° : <span id="pump03Start">--:--</span> ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô : <span id="pump03Humidity">--¬∞C</span></div>
            </div>
          </div>
        </div>


      </div>

      <div class="text-Title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
      <div class="card-detail">
        <p> </p>
      </div>

    </div>
  </div>

</body>

<script>
  const sheetURL = "https://script.google.com/macros/s/AKfycbz4-SY84uzvjr0aHUxWMPyEgIfweCw-EcTOp498PN7w4Yb-Y7qB1qU73qMHxb3caMB84w/exec";
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô-‡∏õ‡∏µ-‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢
  function getThaiDateTime(date) {
    const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"];
    const months = [
      "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
      "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
    ];

    const day = days[date.getDay()];
    const d = date.getDate();
    const m = months[date.getMonth()];
    const y = date.getFullYear() + 543;
    const h = date.getHours().toString().padStart(2, '0');
    const min = date.getMinutes().toString().padStart(2, '0');
    const sec = date.getSeconds().toString().padStart(2, '0');

    return `‡∏ß‡∏±‡∏ô${day} ‡∏ó‡∏µ‡πà ${d} ${m} ‡∏û.‡∏®. ${y} ‡πÄ‡∏ß‡∏•‡∏≤ ${h}:${min} ‡∏ô.`;
  }

  async function loadData() {
    try {
      const res = await fetch(sheetURL);
      const data = await res.json();

      for (const key in data) {
        if (data[key] === "" || data[key] === 0 || data[key] === null || data[key] === undefined) {
          data[key] = "--";
        }
      }

      document.getElementById("temp").textContent = data.temperature === "--" ? "--" : "üå°Ô∏è" + data.temperature + "¬∞C";
      document.getElementById("humidity").textContent = data.humidity === "--" ? "--" : "üíß" + data.humidity + "%";
      document.getElementById("light").textContent = data.light === "--" ? "--" : "üå§Ô∏è" + data.light + " Lux";

      document.getElementById("pump1").textContent = data.pump1 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : (data.pump1 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--");
      document.getElementById("pump2").textContent = data.pump2 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : (data.pump2 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--");
      document.getElementById("pump3").textContent = data.pump3 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : (data.pump3 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--");

      const now = new Date();
      document.getElementById("lastUpdate").textContent = getThaiDateTime(now);

    } catch (error) {
      console.error("‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", error);
    }
  }

  let waterStatus = false;

  async function toggleWater() {
    const isChecked = document.getElementById("waterSwitch").checked;
    const newStatus = isChecked ? "ON" : "OFF";

    try {
      // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á API ‡∏´‡∏£‡∏∑‡∏≠ Apps Script (‡πÅ‡∏Å‡πâ URL ‡∏à‡∏£‡∏¥‡∏á)
      const res = await fetch(sheetURL + "?action=set&water=" + newStatus);
      const result = await res.json();

      if (result.success) {
        waterStatus = (newStatus === "ON");
        updateWaterUI(waterStatus);
      } else {
        alert("‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        document.getElementById("waterSwitch").checked = !isChecked;
      }
    } catch (error) {
      alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
      console.error(error);
      document.getElementById("waterSwitch").checked = !isChecked;
    }
  }

  function updateWaterUI(status) {
    const now = new Date();
    document.getElementById("waterStatusText").textContent = status ? "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà üíß" : "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ô‡πâ‡∏≥‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà üö´";
    document.getElementById("waterLogText").textContent = `‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${status ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏ô‡πâ‡∏≥" : "‡∏õ‡∏¥‡∏î‡∏ô‡πâ‡∏≥"}‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${getThaiDateTime(now)}`;
  }

  window.onload = () => {
    loadData();
    setInterval(loadData, 1000); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  };
</script>



</html>

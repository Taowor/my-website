<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@400;500;600;700&display=swap');

    body {
      background-color: #0a1a64;
      margin: 0;
      font-family: 'Prompt', sans-serif;
    }

    .header {
      padding: 15px;
      color: #ffffff;
    }

    .header .text {
      font-weight: bold;
      font-size: 20px;
    }

    .container {
      display: grid;
      padding: 10px;
      background-color: aliceblue;
      border-radius: 25px 25px 0 0;
      font-weight: normal;
    }

    .environment {
      display: grid;
    }

    .text-Title {
      font-size: 16px;
      color: #454545;
      padding-left: 10PX;
    }

    .text-Time {
      font-size: 10px;
      font-weight: normal;
      color: #6d6d6d;
    }

    .text-label {
      color: #dedede;
      font-size: 10px;
    }

    .text-value {
      font-size: 14px;
    }

    .card-mainEnvi {
      display: flex;
      background-image: url('Background.png');
      background-color: #ffffff;
      border-radius: 15PX;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
      padding: 20px;
      margin-bottom: 10px;
      /* text-align: center; */
    }

    .card-mainEnvi .column {
      flex: 1;
      padding: 0 10px;
    }

    .card-control {
      display: flex;
      background: #0a1a64;
      border-radius: 15PX;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 10px;
    }

    .card-detail {
      display: flex;
      background: #ffffff;
      border-radius: 15PX;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 10px;
    }


    /* ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏ô‡πâ‡∏≥*/
    .toggle-container {
      position: relative;
      width: 60px;
      height: 34px;
      margin-right: 15px;
    }

    .toggle-checkbox {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-label {
      position: absolute;
      cursor: pointer;
      background-color: #ccc;
      border-radius: 34px;
      width: 100%;
      height: 100%;
      transition: background-color 0.4s;
    }

    .toggle-label::before {
      content: "";
      position: absolute;
      left: 4px;
      top: 4px;
      height: 26px;
      width: 26px;
      background-color: white;
      border-radius: 50%;
      transition: transform 0.4s;
    }

    .toggle-checkbox:checked+.toggle-label {
      background-color: #4c66ff;
    }

    .toggle-checkbox:checked+.toggle-label::before {
      transform: translateX(26px);
    }

    .card-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .water-info {
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }

    .water-log {
      color: #6b6b6b;
      font-size: 12px;
    }
  </style>
</head>

<body>

  <div class="header">
    <div class="text">Tuawor Smart Farm</div>
    <div class="text-Time" id="lastUpdate"></div>
  </div>
  <div class="container">
    <div class="environment">
      <div class="text-Title">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</div>
      <div class="card-mainEnvi">
        <div class="column">
          <div class="column">
            <div>
              <div class="text-label">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</div>
              <div class="text-value" id="temp">--</div>
            </div>
            <div>
              <div class="text-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</div>
              <div class="text-value" id="humidity">--</div>
            </div>
            <div>
              <div class="text-label">‡πÅ‡∏™‡∏á‡πÅ‡∏î‡∏î</div>
              <div class="text-value" id="light">--</div>
            </div>
          </div>
        </div>
        <div class="column">
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 01</div>
            <div class="text-value" id="pump1">--</div>
          </div>
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 02</div>
            <div class="text-value" id="pump2">--</div>
          </div>
          <div>
            <div class="text-label">‡∏õ‡∏±‡πâ‡∏° 03</div>
            <div class="text-value" id="pump3">--</div>
          </div>
        </div>
      </div>

      <div class="text-Title">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</div>
      <div class="card-control">

        <div class="toggle-container">
          <input type="checkbox" id="waterSwitch" class="toggle-checkbox" onchange="toggleWater()" />
          <label for="waterSwitch" class="toggle-label"></label>
        </div>
        <div class="water-info">
          <div id="waterStatusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞...</div>
          <div id="waterLogText" class="water-log">--</div>
        </div>

      </div>

      <div class="text-Title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
      <div class="card-detail">
        <p> </p>
      </div>

    </div>
  </div>

</body>

<script>
  const sheetURL = "https://script.google.com/macros/s/AKfycbz4-SY84uzvjr0aHUxWMPyEgIfweCw-EcTOp498PN7w4Yb-Y7qB1qU73qMHxb3caMB84w/exec";
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô-‡πÄ‡∏î‡∏∑‡∏≠‡∏ô-‡∏õ‡∏µ-‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢
  function getThaiDateTime(date) {
    const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"];
    const months = [
      "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
      "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
    ];

    const day = days[date.getDay()];
    const d = date.getDate();
    const m = months[date.getMonth()];
    const y = date.getFullYear() + 543;
    const h = date.getHours().toString().padStart(2, '0');
    const min = date.getMinutes().toString().padStart(2, '0');
    const sec = date.getSeconds().toString().padStart(2, '0');

    return `‡∏ß‡∏±‡∏ô${day} ‡∏ó‡∏µ‡πà ${d} ${m} ‡∏û.‡∏®. ${y} ‡πÄ‡∏ß‡∏•‡∏≤ ${h}:${min} ‡∏ô.`;
  }

  async function loadData() {
    try {
      const res = await fetch(sheetURL);
      const data = await res.json();

      for (const key in data) {
        if (data[key] === "" || data[key] === 0 || data[key] === null || data[key] === undefined) {
          data[key] = "--";
        }
      }

      document.getElementById("temp").textContent = data.temperature === "--" ? "--" : "üå°Ô∏è" + data.temperature + "¬∞C";
      document.getElementById("humidity").textContent = data.humidity === "--" ? "--" : "üíß" + data.humidity + "%";
      document.getElementById("light").textContent = data.light === "--" ? "--" : "üå§Ô∏è" + data.light + " Lux";

      document.getElementById("pump1").textContent = data.pump1 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : (data.pump1 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--");
      document.getElementById("pump2").textContent = data.pump2 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : (data.pump2 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--");
      document.getElementById("pump3").textContent = data.pump3 === "ON" ? "‚õàÔ∏è ‡πÄ‡∏õ‡∏¥‡∏î" : (data.pump3 === "OFF" ? "‚úä ‡∏õ‡∏¥‡∏î" : "--");

      const now = new Date();
      document.getElementById("lastUpdate").textContent = getThaiDateTime(now);

    } catch (error) {
      console.error("‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", error);
    }
  }

  let waterStatus = false;

  async function toggleWater() {
    const isChecked = document.getElementById("waterSwitch").checked;
    const newStatus = isChecked ? "ON" : "OFF";

    try {
      // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á API ‡∏´‡∏£‡∏∑‡∏≠ Apps Script (‡πÅ‡∏Å‡πâ URL ‡∏à‡∏£‡∏¥‡∏á)
      const res = await fetch(sheetURL+"?action=set&water="+newStatus);
      const result = await res.json();

      if (result.success) {
        waterStatus = (newStatus === "ON");
        updateWaterUI(waterStatus);
      } else {
        alert("‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        document.getElementById("waterSwitch").checked = !isChecked;
      }
    } catch (error) {
      alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
      console.error(error);
      document.getElementById("waterSwitch").checked = !isChecked;
    }
  }

  function updateWaterUI(status) {
    const now = new Date();
    document.getElementById("waterStatusText").textContent = status ? "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà üíß" : "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ô‡πâ‡∏≥‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà üö´";
    document.getElementById("waterLogText").textContent = `‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${status ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏ô‡πâ‡∏≥" : "‡∏õ‡∏¥‡∏î‡∏ô‡πâ‡∏≥"}‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${getThaiDateTime(now)}`;
  }

  window.onload = () => {
    loadData();
    setInterval(loadData, 1000); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
  };
</script>



</html>
